"use strict";(self.webpackChunkhashicorp_aws=self.webpackChunkhashicorp_aws||[]).push([[3308],{6807:(e,s,n)=>{n.r(s),n.d(s,{assets:()=>r,contentTitle:()=>t,default:()=>d,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var i=n(5893),l=n(1151);const o={sidebar_position:3,title:"MLflow Model through REST API"},t=void 0,a={id:"mlflow",title:"MLflow Model through REST API",description:"[//]: # (Copyright Jiaqi Liu)",source:"@site/docs/3-mlflow.md",sourceDirName:".",slug:"/mlflow",permalink:"/hashicorp-aws/docs/mlflow",draft:!1,unlisted:!1,editUrl:"https://github.com/QubitPi/hashicorp-aws/tree/master/docs/docs/3-mlflow.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"MLflow Model through REST API"},sidebar:"tutorialSidebar",previous:{title:"Setup",permalink:"/hashicorp-aws/docs/setup"},next:{title:"Elastic Stack (ELK)",permalink:"/hashicorp-aws/docs/elk"}},r={},c=[{value:"Manual Deployment",id:"manual-deployment",level:2}];function h(e){const s={a:"a",admonition:"admonition",code:"code",em:"em",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(s.h2,{id:"manual-deployment",children:"Manual Deployment"}),"\n",(0,i.jsx)(s.p,{children:"The following script variables need to be defined:"}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html",children:(0,i.jsx)(s.strong,{children:"AWS_ACCESS_KEY_ID"})})," & ",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html",children:(0,i.jsx)(s.strong,{children:"AWS_SECRET_ACCESS_KEY"})})]}),"\n",(0,i.jsxs)(s.admonition,{type:"info",children:[(0,i.jsxs)(s.p,{children:["The ",(0,i.jsx)(s.em,{children:"IAM user"})," associated with the credentials above must have the following ",(0,i.jsx)(s.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_access-management.html",children:"AWS permissions policies"}),":"]}),(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"IAMFullAccess"}),"\n",(0,i.jsx)(s.li,{children:"AmazonEC2FullAccess"}),"\n",(0,i.jsx)(s.li,{children:"AmazonRoute53FullAccess"}),"\n"]})]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"HC_DIR"}),": The local absolute path to the ",(0,i.jsx)(s.a,{href:"https://qubitpi.github.io/hashicorp-aws/",children:"hashicorp-aws"})," directory"]}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:[(0,i.jsx)(s.strong,{children:"HC_CONFIG_DIR"}),": The local absolute path to a directory containing the following deployment files:"]}),"\n",(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.a,{href:"https://qubitpi.github.io/hashicorp-packer/packer/guides/hcl/variables#from-a-file",children:"HashiCorp Packer variable file"})," named ",(0,i.jsx)(s.strong,{children:"aws-mlflow-docker.pkrvars.hcl"})," with the\nfollowing variable values (",(0,i.jsx)(s.code,{children:"/abs/path/to/hashicorp-aws-config-dir/aws-mlflow-docker.pkrvars.hcl"}),"):"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:'aws_image_region = "my-aws-region"\nami_name         = "my-mlflow-models"\ninstance_type                    = "<one of t2.micro/t2.small/t2.medium/t2.large/t2.xlarge/t2.2xlarge>"\nml_models_path   = "/abs/path/to/mlflow_models/"\n'})}),"\n"]}),"\n",(0,i.jsxs)(s.li,{children:["\n",(0,i.jsxs)(s.p,{children:["A ",(0,i.jsx)(s.a,{href:"https://qubitpi.github.io/hashicorp-terraform/terraform/language/values/variables#variable-definitions-tfvars-files",children:"HashiCorp Terraform variable file"})," named ",(0,i.jsx)(s.strong,{children:"aws-mlflow-docker.tfvars"})," with the\nfollowing variable values (",(0,i.jsx)(s.code,{children:"/abs/path/to/hashicorp-aws-config-dir/aws-mlflow-docker.tfvars"}),"):"]}),"\n",(0,i.jsx)(s.pre,{children:(0,i.jsx)(s.code,{className:"language-hcl",children:'aws_deploy_region   = "my-aws-region"\nami_name            = "my-mlflow-models"\ninstance_type       = "<one of t2.micro/t2.small/t2.medium/t2.large/t2.xlarge/t2.2xlarge>"\nec2_instance_name   = "My MLflow models"\nkey_name            = "myKeyPairName"\nec2_security_groups = ["myKeyPairName"]\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(s.p,{children:["Then we can execute the ",(0,i.jsx)(s.strong,{children:(0,i.jsx)(s.a,{href:"https://github.com/QubitPi/hashicorp-aws/blob/master/hashicorp/mlflow/deploy.sh",children:"deploy.sh"})})," to manually deploy any MLflow models"]}),"\n",(0,i.jsx)(s.admonition,{type:"info",children:(0,i.jsxs)(s.ul,{children:["\n",(0,i.jsx)(s.li,{children:"The packer simply builds a non-model specific AMI"}),"\n",(0,i.jsxs)(s.li,{children:["If the container runs multiple models at different ports, make sure to add a ",(0,i.jsx)(s.strong,{children:"PORT"})," file containg a port number only\nin each sub-dir of ",(0,i.jsx)(s.code,{children:"/abs/path/to/mlflow_models/"})]}),"\n",(0,i.jsxs)(s.li,{children:["If we need custom module imports in model, add module.py and a ",(0,i.jsx)(s.code,{children:"__init__.py"})," file to the sub-dir of\n",(0,i.jsx)(s.code,{children:"/abs/path/to/mlflow_models/my-model"})]}),"\n"]})})]})}function d(e={}){const{wrapper:s}={...(0,l.a)(),...e.components};return s?(0,i.jsx)(s,{...e,children:(0,i.jsx)(h,{...e})}):h(e)}},1151:(e,s,n)=>{n.d(s,{Z:()=>a,a:()=>t});var i=n(7294);const l={},o=i.createContext(l);function t(e){const s=i.useContext(o);return i.useMemo((function(){return"function"==typeof e?e(s):{...s,...e}}),[s,e])}function a(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),i.createElement(o.Provider,{value:s},e.children)}}}]);