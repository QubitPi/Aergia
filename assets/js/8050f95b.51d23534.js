"use strict";(self.webpackChunkhashicorp_aws=self.webpackChunkhashicorp_aws||[]).push([[6979],{3010:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>t,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>r,toc:()=>c});var s=i(5893),l=i(1151);const o={sidebar_position:3,title:"MLflow Model through REST API"},a="Deploying Machine Learning Models to Production as REST API",r={id:"machine-learning",title:"MLflow Model through REST API",description:"[//]: # (Copyright Jiaqi Liu)",source:"@site/docs/machine-learning.md",sourceDirName:".",slug:"/machine-learning",permalink:"/hashicorp-aws/docs/machine-learning",draft:!1,unlisted:!1,editUrl:"https://github.com/QubitPi/hashicorp-aws/tree/master/docs/docs/machine-learning.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3,title:"MLflow Model through REST API"},sidebar:"tutorialSidebar",previous:{title:"Setup",permalink:"/hashicorp-aws/docs/setup"},next:{title:"Elastic Stack (ELK)",permalink:"/hashicorp-aws/docs/elk"}},t={},c=[{value:"MLflow",id:"mlflow",level:2},{value:"Manual Deployment",id:"manual-deployment",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"deploying-machine-learning-models-to-production-as-rest-api",children:"Deploying Machine Learning Models to Production as REST API"}),"\n",(0,s.jsx)(n.h2,{id:"mlflow",children:"MLflow"}),"\n",(0,s.jsx)(n.h2,{id:"manual-deployment",children:"Manual Deployment"}),"\n",(0,s.jsx)(n.p,{children:"The following script variables need to be defined:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html",children:(0,s.jsx)(n.strong,{children:"AWS_ACCESS_KEY_ID"})})," & ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/cli/latest/userguide/cli-configure-envvars.html",children:(0,s.jsx)(n.strong,{children:"AWS_SECRET_ACCESS_KEY"})})]}),"\n",(0,s.jsxs)(n.admonition,{type:"info",children:[(0,s.jsxs)(n.p,{children:["The ",(0,s.jsx)(n.em,{children:"IAM user"})," associated with the credentials above must have the following ",(0,s.jsx)(n.a,{href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction_access-management.html",children:"AWS permissions policies"}),":"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"IAMFullAccess"}),"\n",(0,s.jsx)(n.li,{children:"AmazonEC2FullAccess"}),"\n",(0,s.jsx)(n.li,{children:"AmazonRoute53FullAccess"}),"\n"]})]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"HC_DIR"}),": The local absolute path to the ",(0,s.jsx)(n.a,{href:"https://qubitpi.github.io/hashicorp-aws/",children:"hashicorp-aws"})," directory"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"HC_CONFIG_DIR"}),": The local absolute path to a directory containing the following deployment files:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.a,{href:"https://qubitpi.github.io/hashicorp-packer/packer/guides/hcl/variables#from-a-file",children:"HashiCorp Packer variable file"})," named ",(0,s.jsx)(n.strong,{children:"aws-mlflow-docker.pkrvars.hcl"})," with the\nfollowing variable values (",(0,s.jsx)(n.code,{children:"/abs/path/to/hashicorp-aws-config-dir/aws-mlflow-docker.pkrvars.hcl"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-hcl",children:'aws_image_region = "my-aws-region"\nami_name         = "my-mlflow-models"\ninstance_type                    = "<one of t2.micro/t2.small/t2.medium/t2.large/t2.xlarge/t2.2xlarge>"\nml_models_path   = "/abs/path/to/mlflow_models/"\n'})}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["\n",(0,s.jsxs)(n.p,{children:["A ",(0,s.jsx)(n.a,{href:"https://qubitpi.github.io/hashicorp-terraform/terraform/language/values/variables#variable-definitions-tfvars-files",children:"HashiCorp Terraform variable file"})," named ",(0,s.jsx)(n.strong,{children:"aws-mlflow-docker.tfvars"})," with the\nfollowing variable values (",(0,s.jsx)(n.code,{children:"/abs/path/to/hashicorp-aws-config-dir/aws-mlflow-docker.tfvars"}),"):"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-hcl",children:'aws_deploy_region   = "my-aws-region"\nami_name            = "my-mlflow-models"\ninstance_type       = "<one of t2.micro/t2.small/t2.medium/t2.large/t2.xlarge/t2.2xlarge>"\nec2_instance_name   = "My MLflow models"\nkey_name            = "myKeyPairName"\nec2_security_groups = ["myKeyPairName"]\n'})}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{type:"info",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The packer simply builds a non-model specific AMI"}),"\n",(0,s.jsxs)(n.li,{children:["If the container runs multiple models at different ports, make sure to add a ",(0,s.jsx)(n.strong,{children:"PORT"})," file containg a port number only\nin each sub-dir of ",(0,s.jsx)(n.code,{children:"/abs/path/to/mlflow_models/"})]}),"\n",(0,s.jsxs)(n.li,{children:["If we need custom module imports in model, add module.py and a ",(0,s.jsx)(n.code,{children:"__init__.py"})," file to the sub-dir of\n",(0,s.jsx)(n.code,{children:"/abs/path/to/mlflow_models/my-model"})]}),"\n"]})})]})}function h(e={}){const{wrapper:n}={...(0,l.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>a});var s=i(7294);const l={},o=s.createContext(l);function a(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:a(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);