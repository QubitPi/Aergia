"use strict";(self.webpackChunkhashicorp_aws=self.webpackChunkhashicorp_aws||[]).push([[472],{9326:(n,e,s)=>{s.r(e),s.d(e,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>i,metadata:()=>a,toc:()=>l});var t=s(5893),o=s(1151);const i={sidebar_position:9,title:"Kong API Gateway"},r=void 0,a={id:"kong",title:"Kong API Gateway",description:"[//]: # (Copyright Jiaqi Liu)",source:"@site/docs/kong.md",sourceDirName:".",slug:"/kong",permalink:"/hashicorp-aws/docs/kong",draft:!1,unlisted:!1,editUrl:"https://github.com/QubitPi/hashicorp-aws/tree/master/docs/docs/kong.md",tags:[],version:"current",sidebarPosition:9,frontMatter:{sidebar_position:9,title:"Kong API Gateway"},sidebar:"tutorialSidebar",previous:{title:"General Troubleshooting",permalink:"/hashicorp-aws/docs/troubleshooting"}},c={},l=[{value:"SSL",id:"ssl",level:2},{value:"Nginx Config",id:"nginx-config",level:3}];function d(n){const e={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,o.a)(),...n.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(e.h2,{id:"ssl",children:"SSL"}),"\n",(0,t.jsx)(e.h3,{id:"nginx-config",children:"Nginx Config"}),"\n",(0,t.jsx)(e.p,{children:"hashicorp-aws assumes the following for all of its management app deployment:"}),"\n",(0,t.jsx)(e.p,{children:(0,t.jsx)(e.strong,{children:"Business logic and SSL/HTTP are separate concerns and must be decoupled from each other"})}),"\n",(0,t.jsx)(e.p,{children:"That being said, hashicorp-aws deploys Kong completely without SSL and spins up a Nginx rever proxy to handle the\nHTTPS redirecting to Kong's pure HTTP app. Therefore:"}),"\n",(0,t.jsxs)(e.ol,{children:["\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["hashicorp-aws uses a ",(0,t.jsx)(e.a,{href:"https://github.com/QubitPi/docker-kong",children:"customized fork of docker-kong"})," to\n",(0,t.jsx)(e.a,{href:"https://github.com/QubitPi/docker-kong/pull/1",children:"fully separate the\napp and SSL"}),",\nand therefore"]}),"\n"]}),"\n",(0,t.jsxs)(e.li,{children:["\n",(0,t.jsxs)(e.p,{children:["the Nginx config needs multiple ",(0,t.jsx)(e.a,{href:"https://www.nginx.com/resources/wiki/start/topics/examples/server_blocks/",children:"servers"}),"\nto ensure all HTTPS ports are mapped to their corresponding HTTP ports as shown in the config snippet below:"]}),"\n",(0,t.jsxs)(e.admonition,{type:"tip",children:[(0,t.jsxs)(e.p,{children:["All relevant HTTP and HTTPS ports are listed in\n",(0,t.jsx)(e.a,{href:"https://qubitpi.github.io/docs.konghq.com/gateway/latest/production/networking/default-ports/",children:"Kong's documentation here"}),". In general, our Nginx should **listen on an HTTPS port\nand ",(0,t.jsx)(e.code,{children:"proxy_pass"})," to an HTTP port. For example, the 8444 is ",(0,t.jsx)(e.code,{children:"proxy_pass"}),'ed to 8001, both of which are listed as the\n"Admin API" ports in the doc.']}),(0,t.jsx)(e.p,{children:"One special case is HTTP port 8002, which is the Kong manager UI port. hashicorp-aws assigns user specified domain\nto each deployed Kong. Hitting the domain will simply open up a user-friendly UI by this configuration."})]}),"\n",(0,t.jsx)(e.pre,{children:(0,t.jsx)(e.code,{className:"language-nginx",metastring:"configuration",children:"\n...\n\nserver {\n    root /var/www/html;\n\n    index index.html index.htm index.nginx-debian.html;\n    server_name my.kongdomain.com;\n\n    location / {\n        proxy_pass http://localhost:8002;\n    }\n\n    listen [::]:443 ssl ipv6only=on;\n    listen 443 ssl;\n    ssl_certificate /etc/ssl/certs/server.crt;\n    ssl_certificate_key /etc/ssl/private/server.key;\n}\n\nserver {\n    root /var/www/html;\n\n    index index.html index.htm index.nginx-debian.html;\n    server_name my.kongdomain.com;\n\n    location / {\n        proxy_pass http://localhost:8001;\n    }\n\n    listen [::]:8444 ssl ipv6only=on;\n    listen 8444 ssl;\n    ssl_certificate /etc/ssl/certs/server.crt;\n    ssl_certificate_key /etc/ssl/private/server.key;\n}\n\n...\n\n"})}),"\n"]}),"\n"]})]})}function h(n={}){const{wrapper:e}={...(0,o.a)(),...n.components};return e?(0,t.jsx)(e,{...n,children:(0,t.jsx)(d,{...n})}):d(n)}},1151:(n,e,s)=>{s.d(e,{Z:()=>a,a:()=>r});var t=s(7294);const o={},i=t.createContext(o);function r(n){const e=t.useContext(i);return t.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(o):n.components||o:r(n.components),t.createElement(i.Provider,{value:e},n.children)}}}]);