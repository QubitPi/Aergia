"use strict";(self.webpackChunkaergia=self.webpackChunkaergia||[]).push([[6935],{3905:(e,t,r)=>{r.d(t,{Zo:()=>c,kt:()=>g});var o=r(7294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,o)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,o,n=function(e,t){if(null==e)return{};var r,o,n={},i=Object.keys(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(o=0;o<i.length;o++)r=i[o],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var l=o.createContext({}),p=function(e){var t=o.useContext(l),r=t;return e&&(r="function"==typeof e?e(t):a(a({},t),e)),r},c=function(e){var t=p(e.components);return o.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var r=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),h=p(r),g=n,m=h["".concat(l,".").concat(g)]||h[g]||u[g]||i;return r?o.createElement(m,a(a({ref:t},c),{},{components:r})):o.createElement(m,a({ref:t},c))}));function g(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=r.length,a=new Array(i);a[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:n,a[1]=s;for(var p=2;p<i;p++)a[p]=r[p];return o.createElement.apply(null,a)}return o.createElement.apply(null,r)}h.displayName="MDXCreateElement"},635:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>p});var o=r(7462),n=(r(7294),r(3905));const i={slug:"nexus",title:"Nexus 3 - Setting Up Docker Registry",authors:["jiaqi"],tags:["Nexus","Docker"],date:new Date("2022-09-29T00:00:00.000Z")},a=void 0,s={permalink:"/aergia/blog/nexus",editUrl:"https://github.com/QubitPi/aergia/tree/gh-pages/blog/nexus-docker-registry/index.md",source:"@site/blog/nexus-docker-registry/index.md",title:"Nexus 3 - Setting Up Docker Registry",description:"Docker containers and their usage have revolutionized the way applications and the underlying operating system are",date:"2022-09-29T00:00:00.000Z",formattedDate:"September 29, 2022",tags:[{label:"Nexus",permalink:"/aergia/blog/tags/nexus"},{label:"Docker",permalink:"/aergia/blog/tags/docker"}],readingTime:3.47,hasTruncateMarker:!0,authors:[{name:"Jiaqi Liu",title:"Maintainer of Aergia",url:"https://github.com/QubitPi",imageURL:"https://avatars.githubusercontent.com/u/16126939?v=4",key:"jiaqi"}],frontMatter:{slug:"nexus",title:"Nexus 3 - Setting Up Docker Registry",authors:["jiaqi"],tags:["Nexus","Docker"],date:"2022-09-29T00:00:00.000Z"},prevItem:{title:"Nexus 3 Repository Manager OSS",permalink:"/aergia/blog/nexus"},nextItem:{title:"Continuous Delivery",permalink:"/aergia/blog/continuous-delivery"}},l={authorsImageUrls:[void 0]},p=[{value:"Docker Port Scalability",id:"docker-port-scalability",level:2},{value:"SSL and Repository Connector Configuration",id:"ssl-and-repository-connector-configuration",level:2},{value:"Scaling Repositories",id:"scaling-repositories",level:2}],c={toc:p};function u(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,o.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("p",null,"Docker containers and their usage have revolutionized the way applications and the underlying operating system are\npackaged and deployed to development, testing and production systems. The creation of the\n",(0,n.kt)("a",{parentName:"p",href:"https://opencontainers.org/"},"Open Container Initiative"),", and the involvement of a large number of stakeholders,\nguarantees that the ecosystem of tools around the lightweight containers and their usage will continue to flourish.\n",(0,n.kt)("a",{parentName:"p",href:"https://hub.docker.com/"},"Docker Hub")," is the original registry for Docker container images and it is being joined by\nmore and more other publicly available registries such as the\n",(0,n.kt)("a",{parentName:"p",href:"https://cloud.google.com/container-registry/"},"Google Container Registry")," and others."),(0,n.kt)("p",null,"Nexus Repository Manager OSS support Docker registries as the Docker repository format for ",(0,n.kt)("strong",{parentName:"p"},"hosted")," and ",(0,n.kt)("strong",{parentName:"p"},"proxy"),"\nrepositories. We can expose these repositories to the client-side tools directly or as a\n",(0,n.kt)("a",{parentName:"p",href:"#repository-group"},"repository group"),", which is a repository that merges and exposes the contents of multiple\nrepositories in one convenient URL. This allows us to reduce time and bandwidth usage for accessing Docker images in a\nregistry as well as share our images within our organization in a hosted repository. Users can then launch containers\nbased on those images, resulting in a completely private Docker registry with all the features available in the\nrepository manager."),(0,n.kt)("h2",{id:"docker-port-scalability"},"Docker Port Scalability"),(0,n.kt)("p",null,"The Docker client has strict requirements about how it can retrieve content from a repository (i.e., a registry). These\nrequirements mainly center around the path at which it expects everything to be hosted."),(0,n.kt)("p",null,"While it is possible to tell the Docker client to use a chosen host from which to retrieve (or to which to upload)\nimages, it is not possible to tell it to use an arbitrary base path where images are stored in a registry."),(0,n.kt)("p",null,"To further explain, the Docker client is given a registry to contact by specifying only the hostname + port. It's also\ngiven a specific path to an image in that registry. So, for example, it would be given\n",(0,n.kt)("inlineCode",{parentName:"p"},"example:443/some/custom/image")," to specify an image. We are not able to specify a registry application path."),(0,n.kt)("p",null,"Nexus Repository exposes its Docker registries with a repository path of ",(0,n.kt)("inlineCode",{parentName:"p"},"/repository/<repo_name>/")," and, by default, and\napplication context path of ",(0,n.kt)("inlineCode",{parentName:"p"},"/"),"."),(0,n.kt)("p",null,'So, a full Docker image in the repository "docker-hosted" might be accessible at full URL\n"example:443/nexus3/repository/docker-hosted/some/custom/image", which can be broken down as follows:'),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"example.com")," = host name"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"443")," = port"),(0,n.kt)("li",{parentName:"ul"},"/nexus3 = application context path"),(0,n.kt)("li",{parentName:"ul"},"/repository/docker-hosted = base registry path"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("strong",{parentName:"li"},"/some/custom/image")," = specific image path in the registry")),(0,n.kt)("p",null,"There is no way to give the Docker client the application context path or base registry path. Docker needs the registry\nexposed at the root of the host + port that it is accessing."),(0,n.kt)("p",null,"This is important because Nexus Repository uses request paths to separate content between different repositories. There\nare a few potential ways to overcome this Docker limitation:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Using a ",(0,n.kt)("a",{parentName:"li",href:"https://en.wikipedia.org/wiki/Reverse_proxy"},"reverse proxy")),(0,n.kt)("li",{parentName:"ol"},"Using ",(0,n.kt)("a",{parentName:"li",href:"#ssl-and-repository-connector-configuration"},"port connectors"))),(0,n.kt)("h2",{id:"ssl-and-repository-connector-configuration"},"SSL and Repository Connector Configuration"),(0,n.kt)("p",null,"Docker relies on secure connections using SSL to connect to the repositories. We are therefore required to expose the\nrepository manager to our client tools via HTTPS. This can be configured via an external proxy server, which can also be\nused to ",(0,n.kt)("a",{parentName:"p",href:"#scaling-repositories"},"scale your repositories"),", or directly with the repository manager."),(0,n.kt)("p",null,'The recommended minimal configuration requires one port for a Docker repository group used for read access to all\nrepositories and one port for each hosted Docker repository that will receive push events from your users. The\nRepository Connectors configuration, displayed in Figure: \u201cRepository Connector Configuration", is available in the\nconfiguration for proxy and hosted Docker repositories as well as Docker repository groups.'),(0,n.kt)("h2",{id:"scaling-repositories"},"Scaling Repositories"))}u.isMDXComponent=!0}}]);