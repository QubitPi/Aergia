<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-recipes/jenkins-github-webhook">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">aergia::jenkins_github_webhook | Aergia</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://qubitpi.github.io/aergia/docs/recipes/jenkins-github-webhook"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="aergia::jenkins_github_webhook | Aergia"><meta data-rh="true" name="description" content="Integrate Jenkins with GitHub through Webhooks"><meta data-rh="true" property="og:description" content="Integrate Jenkins with GitHub through Webhooks"><link data-rh="true" rel="icon" href="/aergia/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://qubitpi.github.io/aergia/docs/recipes/jenkins-github-webhook"><link data-rh="true" rel="alternate" href="https://qubitpi.github.io/aergia/docs/recipes/jenkins-github-webhook" hreflang="en"><link data-rh="true" rel="alternate" href="https://qubitpi.github.io/aergia/docs/recipes/jenkins-github-webhook" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/aergia/blog/rss.xml" title="Aergia RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/aergia/blog/atom.xml" title="Aergia Atom Feed"><link rel="stylesheet" href="/aergia/assets/css/styles.f860236f.css">
<link rel="preload" href="/aergia/assets/js/runtime~main.a997368d.js" as="script">
<link rel="preload" href="/aergia/assets/js/main.08bf9f5a.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aergia/"><div class="navbar__logo"><img src="/aergia/img/logo.png" alt="Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/aergia/img/logo.png" alt="Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Aergia</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/aergia/docs/intro">Recipes</a><a class="navbar__item navbar__link" href="/aergia/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/QubitPi/aergia" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/aergia/docs/category/recipes">Recipes</a><button aria-label="Toggle the collapsible sidebar category &#x27;Recipes&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/docker">aergia::docker</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/docker-compose">aergia::docker_compose</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/certbot">aergia::certbot</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/docker-registry">aergia::docker_registry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/jenkins">aergia::jenkins</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/jenkins-agent">aergia::jenkins_agent</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aergia/docs/recipes/jenkins-github-webhook">aergia::jenkins_github_webhook</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/nexus">aergia::nexus</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aergia/docs/recipes/keycloak">aergia::keycloak</a></li></ul></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/aergia/docs/intro">intro</a></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aergia/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/aergia/docs/category/recipes"><span itemprop="name">Recipes</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">aergia::jenkins_github_webhook</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>aergia::jenkins_github_webhook</h1><p>Integrate <strong>Jenkins</strong> with <strong>GitHub</strong> through Webhooks</p><p>This approach works great for most enterprise GitHub repos (i.e. private repos), whose CI/CD logics are not publicly
visible</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recipe-details">Recipe Details<a class="hash-link" href="#recipe-details" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-webhook-on-github">Configuring Webhook on GitHub<a class="hash-link" href="#configuring-webhook-on-github" title="Direct link to heading">​</a></h3><p><strong>Step 1</strong>: go to a target GitHub repository and click on &quot;<strong>Settings</strong>&quot;.</p><p><img loading="lazy" alt="Error loading jengit1.png" src="/aergia/assets/images/jengit1-05d523173cbc2d5c7e1ef7e650b691cf.png" width="744" height="282" class="img_ev3q"></p><p><strong>Step 2</strong>: Click on Webhooks and then click on &quot;<strong>Add webhook</strong>&quot;.</p><p><img loading="lazy" alt="Error loading jengit2.png" src="/aergia/assets/images/jengit2-a7b058fb67afb168d20b137290a6b53d.png" width="792" height="362" class="img_ev3q"></p><p><strong>Step 3</strong>: In the &quot;<strong>Payload URL</strong>&quot; field, paste your Jenkins environment URL. At the end of this URL add
<strong>/github-webhook/</strong>. In the &quot;Content type&quot; select: &quot;application/json&quot; and leave the &quot;Secret&quot; field empty.</p><p><img loading="lazy" alt="Error loading jengit3.png" src="/aergia/assets/images/jengit3-31bd436c6a0cb613cec3fd091ea9b610.png" width="693" height="290" class="img_ev3q"></p><p><strong>Step 4</strong>: In the page &quot;Which events would you like to trigger this webhook?&quot; choose &quot;<em>Let me select individual
events.</em>&quot; Then, check &quot;Pull Requests&quot; and &quot;Pushes&quot;. At the end of this option, make sure that the &quot;Active&quot; option is
checked and click on &quot;<strong>Add webhook</strong>&quot;.</p><p><img loading="lazy" alt="Error loading jengit4.png" src="/aergia/assets/images/jengit4-7614448638ad24f1ed827f75dfc0a7e1.png" width="430" height="380" class="img_ev3q">
<img loading="lazy" alt="Error loading jengit5.png" src="/aergia/assets/images/jengit5-2d2a66f77e2c0fa28a360f593ce12882.png" width="482" height="460" class="img_ev3q"></p><p>We&#x27;re done with the configuration on GitHub’s side! Now let&#x27;s move on to Jenkins.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="allow-access-private-github-repository-from-jenkinschef-node">Allow Access Private GitHub Repository From Jenkins/Chef Node<a class="hash-link" href="#allow-access-private-github-repository-from-jenkinschef-node" title="Direct link to heading">​</a></h3><p>We can &quot;git clone&quot; a private repository on GitHub.com to our Jenkins Node server by using a <strong>deploy key</strong>, which is an
SSH key that grants access to a single repository. GitHub attaches the public part of the key directly to the private
repository instead of a personal account, and the private part of the key remains on the Jenkins Node server. For more
information, see &quot;<a href="https://docs.github.com/en/rest/guides/delivering-deployments" target="_blank" rel="noopener noreferrer">Delivering deployments</a>&quot;.</p><p>Deploy keys with write access can perform the same actions as an organization member with admin access, or a
collaborator on a personal repository.</p><p>Pros:</p><ul><li>Anyone with access to the repository and server has the ability to deploy the project.</li><li>Users don&#x27;t have to change their local SSH settings.</li><li>Deploy keys are read-only by default, but we can give them write access when adding them to a repository.</li></ul><p>Cons:</p><ul><li>Deploy keys only grant access to a single repository. More complex projects may have many repositories to pull to the
same server.</li><li>Deploy keys are usually not protected by a passphrase, making the key easily accessible if the server is compromised.</li></ul><h4 class="anchor anchorWithStickyNavbar_LWe7" id="generate-and-load-ssh-key-pair-on-jenkins-agent-node">Generate and Load SSH Key Pair on Jenkins Agent Node<a class="hash-link" href="#generate-and-load-ssh-key-pair-on-jenkins-agent-node" title="Direct link to heading">​</a></h4><p>Since Jenkins agent runs under &quot;jenkins&quot; user, <code>jenkins_github_webhook</code> makes sure &quot;jenkins&quot; user exits on a Chef node
first. If it&#x27;s not there, it will effectively execute</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">su</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">useradd</span><span class="token plain"> -d /var/lib/jenkins jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> -p /var/lib/jenkins/.ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><code>jenkins_github_webhook</code> will then generate and load a key pair onto &quot;jenkins&quot; user:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>Note that the key pair will always be &quot;id_rsa&quot; and &quot;id_rsa.pub&quot;; we will explain that later</p></div></div><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> ~/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">cp</span><span class="token plain"> id_rsa id_rsa.pub /var/lib/jenkins/.ssh/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R jenkins /var/lib/jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chown</span><span class="token plain"> -R jenkins /var/lib/jenkins/.ssh</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">chmod</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">700</span><span class="token plain"> /var/lib/jenkins/.ssh</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="using-multiple-repositories-on-one-chef-node-using-multiple-deploy-keys">Using Multiple Repositories on One Chef Node using Multiple Deploy Keys<a class="hash-link" href="#using-multiple-repositories-on-one-chef-node-using-multiple-deploy-keys" title="Direct link to heading">​</a></h4><p>If we use (i.e. &#x27;git clone&#x27;) multiple repositories on one server, we will need to generate a dedicated key pair for each
one. <strong>GitHub does not allow reusing a deploy key for multiple repositories</strong>.</p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>GitHub does not allow reusing a deploy key for multiple repositories</p></div></div><p>In the chef node&#x27;s SSH configuration file (i.e. <code>/var/lib/jenkins/.ssh/config</code>), add an alias entry for each repository.
For example:</p><div class="language-config codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-config codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host github.com-repo-0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Hostname github.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IdentityFile=/var/lib/jenkins/.ssh/repo-0_deploy_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Host github.com-repo-1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        Hostname github.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        IdentityFile=/var/lib/jenkins/.ssh/repo-1_deploy_key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li><code>Host github.com-repo-0</code> - The repository&#x27;s alias.</li><li><code>Hostname github.com</code> - Configures the hostname to use with the alias.</li><li><code>IdentityFile=/var/lib/jenkins/.ssh/repo-0_deploy_key</code> - Assigns a private key to the alias.</li></ul><div class="theme-admonition theme-admonition-tip alert alert--success admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"></path></svg></span>tip</div><div class="admonitionContent_S0QG"><p>The regular <code>ssh-keygen</code> command in the case of this example becomes</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -f ~/.ssh/repo-0_deploy_key</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ssh-keygen -f ~/.ssh/repo-1_deploy_key</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div><p>We can then use the hostname&#x27;s alias to interact with the repository using SSH, which will use the unique deploy key
assigned to that alias. For example:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone git@github.com-repo-1:OWNER/repo-1.git</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="add-public-key-as-deploy-key-to-github-private-repository">Add Public Key as Deploy Key to GitHub Private Repository<a class="hash-link" href="#add-public-key-as-deploy-key-to-github-private-repository" title="Direct link to heading">​</a></h3><p>Navigate to the private repository UI on GitHub, from there, From the repository, click <strong>Settings</strong>.</p><p><img loading="lazy" alt="Error loading repo-settings.png" src="/aergia/assets/images/repo-settings-c8d621839bb064397ff62180ee2976a8.png" width="866" height="96" class="img_ev3q"></p><p>In the sidebar, click <strong>Deploy Keys</strong>, then click <strong>Add deploy key</strong>.</p><p><img loading="lazy" alt="Error loading add-deploy-key.png" src="/aergia/assets/images/add-deploy-key-eab0d8ca1ff48253124147e9e1589ada.png" width="2088" height="622" class="img_ev3q"></p><p>Provide a title, paste in the public key (File content of <code>id_rsa.pub</code> we generated in previous step).</p><p><img loading="lazy" alt="Error loading deploy-key.png" src="/aergia/assets/images/deploy-key-eff7e8504e92d7759d4e2111b20b0824.png" width="2154" height="1194" class="img_ev3q"></p><div class="theme-admonition theme-admonition-caution alert alert--warning admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>caution</div><div class="admonitionContent_S0QG"><p>Make sure the pasted content in the text box ends with
an empty line</p><p>Select <strong>Allow write access</strong> if we want this key to have write access to the repository. A deploy key with write access
lets a deployment push to the repository.</p></div></div><p>Click <strong>Add key</strong>.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="complete-key-verification-on-agent-node">Complete Key Verification on Agent Node<a class="hash-link" href="#complete-key-verification-on-agent-node" title="Direct link to heading">​</a></h3><p>As the last step, we will manually verify ssh GitHub host keys using</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">su</span><span class="token plain"> -s /bin/bash jenkins</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> ~</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">ssh</span><span class="token plain"> -T git@github.com</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>If we look at verbose output of the last command using <code>ssh -T git@github.com</code> we will see why the aforementioned
<code>ssh-keygen</code> command must be required to generate the fixed name of &quot;id_rsa&quot; and &quot;id_rsa.pub&quot;, which turns out are
picked up as hard-coded name.</p></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-jenkins-job">Configuring Jenkins Job<a class="hash-link" href="#configuring-jenkins-job" title="Direct link to heading">​</a></h3><p><strong>Step 5</strong>: In Jenkins, click on &quot;<strong>New Item</strong>&quot; to create a new project.</p><p><img loading="lazy" alt="Error loading jengit6.png" src="/aergia/assets/images/jengit6-b4d0f3334f4df94b605101ec3c4db899.png" width="412" height="343" class="img_ev3q"></p><p><strong>Step 6</strong>: Give your project a name, then choose &quot;<strong>Freestyle project</strong>&quot; and finally, click on &quot;OK&quot;.</p><p><img loading="lazy" alt="Error loading jengit7.png" src="/aergia/assets/images/jengit7-90b58fb9c5711cf3472b93586358bdd3.png" width="487" height="427" class="img_ev3q"></p><p><strong>Step 7</strong>: Click on the &quot;<strong>Source Code Management</strong>&quot; tab.</p><p><img loading="lazy" alt="Error loading jengit8.png" src="/aergia/assets/images/jengit8-eec226a051cf59205f522bc432adee82.png" width="417" height="352" class="img_ev3q"></p><p><strong>Step 8</strong>: Click on Git and paste your GitHub repository URL in the &quot;<strong>Repository URL</strong>&quot; field. The &quot;Credentials&quot; will
be used by &quot;jenkins&quot; to <code>git clone</code> source code, which will be compiled and deployed, from GitHub. We should
<a href="/aergia/docs/recipes/jenkins-agent#configuring-jenkins-credential-on-controller-node-on-first-use">add a new <strong>Jenkins credential</strong> of this <strong>agent</strong> node</a>
as well</p><p><img loading="lazy" alt="Error loading jengit9.png" src="/aergia/assets/images/jengit9-b739c94529384a4bf70a5963ec4f4de9.png" width="557" height="281" class="img_ev3q"></p><p><strong>Step 9</strong>: Click on the &quot;<strong>Build Triggers</strong>&quot; tab and then on the &quot;<em>GitHub hook trigger for GITScm polling</em>&quot;. Or,
choose the trigger of your choice.</p><p><img loading="lazy" alt="Error loading jengit10.png" src="/aergia/assets/images/jengit10-fe79c7981d32a1438fb4bf4aeab2dfa2.png" width="972" height="443" class="img_ev3q"></p><p>That&#x27;s it! Our GitHub repository has integrated with our Jenkins project. With this Jenkins GitHub integration, we can
now use any file found in the GitHub repository and trigger the Jenkins job to run with every code commit.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recipe-verification">Recipe Verification<a class="hash-link" href="#recipe-verification" title="Direct link to heading">​</a></h2></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/QubitPi/aergia/tree/gh-pages/docs/recipes/jenkins-github-webhook.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/aergia/docs/recipes/jenkins-agent"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">aergia::jenkins_agent</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aergia/docs/recipes/nexus"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">aergia::nexus</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#recipe-details" class="table-of-contents__link toc-highlight">Recipe Details</a><ul><li><a href="#configuring-webhook-on-github" class="table-of-contents__link toc-highlight">Configuring Webhook on GitHub</a></li><li><a href="#allow-access-private-github-repository-from-jenkinschef-node" class="table-of-contents__link toc-highlight">Allow Access Private GitHub Repository From Jenkins/Chef Node</a></li><li><a href="#add-public-key-as-deploy-key-to-github-private-repository" class="table-of-contents__link toc-highlight">Add Public Key as Deploy Key to GitHub Private Repository</a></li><li><a href="#complete-key-verification-on-agent-node" class="table-of-contents__link toc-highlight">Complete Key Verification on Agent Node</a></li><li><a href="#configuring-jenkins-job" class="table-of-contents__link toc-highlight">Configuring Jenkins Job</a></li></ul></li><li><a href="#recipe-verification" class="table-of-contents__link toc-highlight">Recipe Verification</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/aergia/docs/category/recipes">Recipes</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/aergia" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/aergia/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/QubitPi/aergia" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 Jiaqi Liu. Built with Docusaurus.</div></div></div></footer></div>
<script src="/aergia/assets/js/runtime~main.a997368d.js"></script>
<script src="/aergia/assets/js/main.08bf9f5a.js"></script>
</body>
</html>